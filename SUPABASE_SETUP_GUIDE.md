# üöÄ Gu√≠a Completa de Configuraci√≥n - Supabase Session Tracking

Esta gu√≠a te llevar√° paso a paso para configurar el sistema de tracking de sesiones con Supabase.

---

## üìã Tabla de Contenidos

1. [Requisitos Previos](#requisitos-previos)
2. [Paso 1: Crear Proyecto en Supabase](#paso-1-crear-proyecto-en-supabase)
3. [Paso 2: Configurar Base de Datos](#paso-2-configurar-base-de-datos)
4. [Paso 3: Configurar el Proyecto](#paso-3-configurar-el-proyecto)
5. [Paso 4: Verificar Funcionamiento](#paso-4-verificar-funcionamiento)
6. [Datos que se Registran](#datos-que-se-registran)
7. [Dashboard de Visualizaci√≥n](#dashboard-de-visualizaci√≥n)
8. [Soluci√≥n de Problemas](#soluci√≥n-de-problemas)

---

## ‚úÖ Requisitos Previos

- Una cuenta en [Supabase](https://supabase.com) (gratuita)
- Acceso al c√≥digo del proyecto
- Un navegador web moderno

---

## üìù Paso 1: Crear Proyecto en Supabase

### 1.1 Crear Cuenta y Proyecto

1. Ve a [https://supabase.com](https://supabase.com)
2. Haz clic en **"Start your project"**
3. Reg√≠strate con tu email o GitHub
4. Una vez dentro, haz clic en **"New project"**

### 1.2 Configurar Proyecto

Complete los siguientes campos:

- **Organization**: Selecciona o crea una organizaci√≥n
- **Project Name**: `landing-page-sessions` (o el nombre que prefieras)
- **Database Password**: Genera una contrase√±a fuerte (¬°gu√°rdala!)
- **Region**: Selecciona la regi√≥n m√°s cercana a tus usuarios
- **Pricing Plan**: Free (gratuito) es suficiente para empezar

5. Haz clic en **"Create new project"**
6. Espera 2-3 minutos mientras Supabase crea tu base de datos

---

## üóÑÔ∏è Paso 2: Configurar Base de Datos

### 2.1 Acceder al SQL Editor

1. En tu proyecto de Supabase, ve al men√∫ lateral
2. Haz clic en **"SQL Editor"** (icono de c√≥digo)
3. Haz clic en **"New query"**

### 2.2 Ejecutar el Schema

1. Abre el archivo `supabase-schema.sql` de este proyecto
2. Copia **TODO** el contenido del archivo
3. Pega el contenido en el SQL Editor de Supabase
4. Haz clic en **"Run"** (‚ñ∂Ô∏è) o presiona `Ctrl + Enter`

### 2.3 Verificar que se Cre√≥ Correctamente

Deber√≠as ver:
```
‚úÖ Schema creado exitosamente!
üìä Tabla: session_logs
üìà Vistas: active_sessions, daily_stats, top_countries
üîê Pol√≠ticas RLS habilitadas
```

Para verificar visualmente:
1. Ve a **"Table Editor"** en el men√∫ lateral
2. Deber√≠as ver la tabla **"session_logs"**
3. Haz clic en ella para ver su estructura

---

## ‚öôÔ∏è Paso 3: Configurar el Proyecto

### 3.1 Obtener Credenciales de Supabase

1. En tu proyecto de Supabase, ve a **"Settings"** (‚öôÔ∏è) en el men√∫ lateral
2. Haz clic en **"API"** en el submen√∫
3. Encontrar√°s dos valores importantes:

   - **Project URL**: `https://xxxxxxxxxxx.supabase.co`
   - **anon public key**: Una clave larga que empieza con `eyJ...`

4. **Copia estos valores** (los necesitar√°s en el siguiente paso)

### 3.2 Configurar el Archivo supabase-config.js

1. Abre el archivo `supabase-config.js` en tu editor de c√≥digo
2. Encuentra estas l√≠neas:

```javascript
const SUPABASE_CONFIG = {
    url: 'TU_SUPABASE_URL_AQUI',
    anonKey: 'TU_SUPABASE_ANON_KEY_AQUI',
    // ...
```

3. Reemplaza los valores:

```javascript
const SUPABASE_CONFIG = {
    url: 'https://tuproyecto.supabase.co', // ‚Üê Tu Project URL aqu√≠
    anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...', // ‚Üê Tu anon key aqu√≠
    // ...
```

4. Guarda el archivo

### 3.3 Subir Cambios a GitHub

```bash
cd /home/user/webapp/landing-page-con-supabase-v1
git add supabase-config.js
git commit -m "feat: Configure Supabase credentials"
git push origin main
```

---

## ‚úÖ Paso 4: Verificar Funcionamiento

### 4.1 Probar el Login

1. Abre tu landing page en el navegador
2. Intenta hacer login con las credenciales correctas
3. Abre la consola del navegador (F12)
4. Deber√≠as ver mensajes como:
   ```
   ‚úÖ Supabase client initialized successfully
   üìç IP Info retrieved: {...}
   ‚úÖ Login tracked successfully
   üíì Heartbeat sent
   ```

### 4.2 Verificar en Supabase

1. Ve a tu proyecto en Supabase
2. Navega a **"Table Editor"**
3. Selecciona la tabla **"session_logs"**
4. Deber√≠as ver tu sesi√≥n registrada con todos los datos

### 4.3 Ver el Dashboard

1. Abre `supabase-dashboard.html` en tu navegador
2. Deber√≠as ver:
   - Estad√≠sticas de sesiones
   - Sesiones activas en tiempo real
   - Historial reciente

---

## üìä Datos que se Registran

### üïí Informaci√≥n Temporal
- **D√≠a y hora de login** (login_time)
- **√öltima actividad** (last_activity) - Se actualiza cada 30 segundos
- **Hora de logout** (logout_time)
- **Duraci√≥n de la sesi√≥n** (session_duration en segundos)

### üåç Informaci√≥n Geogr√°fica
- **Pa√≠s** (country)
- **C√≥digo de pa√≠s** (country_code)
- **Regi√≥n/Estado** (region)
- **Ciudad** (city)
- **Latitud y Longitud** (latitude, longitude)
- **Zona horaria** (timezone)

### üíª Informaci√≥n del Dispositivo
- **User Agent completo** (user_agent)
- **Navegador y versi√≥n** (browser, browser_version)
- **Sistema operativo** (os, os_version)
- **Tipo de dispositivo** (device_type: desktop, mobile, tablet)
- **Fabricante y modelo** (device_vendor, device_model)
- **Resoluci√≥n de pantalla** (screen_resolution)
- **Idioma del navegador** (language)

### üåê Informaci√≥n de Red
- **Direcci√≥n IP** (ip_address)
- **Proveedor de Internet** (isp)

### üìà M√©tricas de Interacci√≥n
- **Estado de conexi√≥n** (is_active: true/false)
- **Login exitoso o fallido** (login_successful)
- **N√∫mero de intentos fallidos** (failed_attempts)
- **P√°ginas visitadas** (pages_visited)

### üîí Informaci√≥n de Seguridad
- **Referrer** (de d√≥nde viene el usuario)
- **P√°gina de entrada** (landing_page)
- **Clave de sesi√≥n** (session_key)
- **Flags de seguridad** (security_flags)
- **Metadata adicional** (metadata en formato JSON)

---

## üìä Dashboard de Visualizaci√≥n

### Caracter√≠sticas del Dashboard

El dashboard (`supabase-dashboard.html`) muestra:

#### üìà Estad√≠sticas Generales:
- Sesiones activas en tiempo real
- Total de logins exitosos (√∫ltimos 7 d√≠as)
- Total de intentos fallidos (√∫ltimos 7 d√≠as)
- Pa√≠ses √∫nicos
- Duraci√≥n promedio de sesiones
- Usuarios √∫nicos

#### üî¥ Sesiones Activas:
- Lista de todas las sesiones actualmente activas
- Ubicaci√≥n de cada usuario
- Tipo de dispositivo y navegador
- Duraci√≥n en tiempo real (se actualiza autom√°ticamente)
- Auto-refresh cada 10 segundos (configurable)

#### üìã Historial Reciente:
- √öltimas 50 sesiones (activas e inactivas)
- Filtrado entre exitosas y fallidas
- Informaci√≥n completa de cada sesi√≥n

### Acceder al Dashboard

**Opci√≥n 1: Localmente**
```bash
# Abre el archivo directamente
open supabase-dashboard.html
# o
python3 -m http.server 8000
# Luego ve a: http://localhost:8000/supabase-dashboard.html
```

**Opci√≥n 2: En GitHub Pages**
```
https://tuusuario.github.io/landing-page-con-supabase-v1/supabase-dashboard.html
```

---

## üîç Consultas √ötiles en Supabase

### Ver sesiones activas ahora mismo:
```sql
SELECT * FROM active_sessions;
```

### Estad√≠sticas del d√≠a de hoy:
```sql
SELECT * FROM daily_stats 
WHERE date = CURRENT_DATE;
```

### Top pa√≠ses por logins:
```sql
SELECT * FROM top_countries 
LIMIT 10;
```

### Sesiones de las √∫ltimas 24 horas:
```sql
SELECT 
    username,
    country,
    city,
    device_type,
    browser,
    login_time,
    session_duration
FROM session_logs
WHERE login_time > NOW() - INTERVAL '24 hours'
ORDER BY login_time DESC;
```

### Intentos fallidos de login:
```sql
SELECT 
    username,
    ip_address,
    country,
    login_time
FROM session_logs
WHERE login_successful = false
ORDER BY login_time DESC
LIMIT 20;
```

---

## üõ†Ô∏è Soluci√≥n de Problemas

### ‚ùå Error: "Supabase not configured"

**Causa**: Las credenciales no est√°n configuradas en `supabase-config.js`

**Soluci√≥n**:
1. Verifica que hayas reemplazado `TU_SUPABASE_URL_AQUI` y `TU_SUPABASE_ANON_KEY_AQUI`
2. Aseg√∫rate de haber guardado el archivo
3. Recarga la p√°gina en el navegador

### ‚ùå Error: "relation 'session_logs' does not exist"

**Causa**: No se ejecut√≥ el schema SQL en Supabase

**Soluci√≥n**:
1. Ve al SQL Editor en Supabase
2. Ejecuta el contenido completo de `supabase-schema.sql`
3. Verifica que no haya errores en la ejecuci√≥n

### ‚ùå No se registran sesiones

**Causa**: Posiblemente un problema de CORS o RLS policies

**Soluci√≥n**:
1. Ve a **Authentication > Policies** en Supabase
2. Verifica que las pol√≠ticas "Allow anonymous insert" y "Allow anonymous select" est√©n activas
3. Si no existen, ejec√∫talas manualmente desde el SQL Editor

### ‚ùå Dashboard no muestra datos

**Causa**: Configuraci√≥n de Supabase o falta de datos

**Soluci√≥n**:
1. Verifica que `supabase-config.js` est√© correctamente configurado
2. Abre la consola del navegador para ver errores
3. Verifica que haya al menos una sesi√≥n registrada en la base de datos

### ‚ö†Ô∏è Informaci√≥n geogr√°fica no aparece

**Causa**: El servicio de geolocalizaci√≥n (ipapi.co) puede tener l√≠mites de tasa

**Soluci√≥n**:
- El servicio gratuito tiene l√≠mite de 1000 requests/d√≠a
- Si necesitas m√°s, considera usar un servicio pago o alternativo
- La aplicaci√≥n funcionar√° normalmente sin esta info, solo aparecer√° como "Desconocido"

---

## üöÄ Pr√≥ximos Pasos Recomendados

### 1. Configurar GitHub Pages

Si a√∫n no lo has hecho:

```bash
# En la configuraci√≥n del repositorio en GitHub
# Ve a Settings > Pages
# Source: Deploy from a branch
# Branch: main / (root)
# Save
```

Tu dashboard estar√° en:
```
https://tuusuario.github.io/landing-page-con-supabase-v1/supabase-dashboard.html
```

### 2. Agregar m√°s m√©tricas

El sistema est√° dise√±ado para ser extensible. Puedes agregar:
- Tracking de eventos espec√≠ficos
- An√°lisis de conversi√≥n
- Heatmaps de interacci√≥n
- Alertas por actividad sospechosa

### 3. Exportar datos

Desde Supabase puedes:
- Exportar a CSV para an√°lisis en Excel
- Conectar con herramientas de BI (Tableau, Power BI)
- Crear backups autom√°ticos

---

## üìö Recursos Adicionales

- [Documentaci√≥n de Supabase](https://supabase.com/docs)
- [Supabase JavaScript Client](https://supabase.com/docs/reference/javascript/introduction)
- [SQL Tutorial](https://supabase.com/docs/guides/database/overview)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)

---

## üí° Consejos de Seguridad

1. **Nunca** compartas tu `service_role` key p√∫blicamente
2. La `anon` key es segura para uso en el frontend
3. Las pol√≠ticas RLS protegen tus datos autom√°ticamente
4. Revisa regularmente los logs para detectar actividad sospechosa
5. Considera agregar autenticaci√≥n adicional para el dashboard

---

## ‚úÖ Checklist Final

Antes de considerar la configuraci√≥n completa, verifica:

- [ ] Proyecto creado en Supabase
- [ ] Schema SQL ejecutado correctamente
- [ ] Credenciales configuradas en `supabase-config.js`
- [ ] Cambios subidos a GitHub
- [ ] Login registra sesi√≥n correctamente
- [ ] Dashboard muestra datos
- [ ] Auto-refresh funciona
- [ ] GitHub Pages configurado (opcional)

---

## üéâ ¬°Todo Listo!

Si completaste todos los pasos, ¬°felicidades! Ahora tienes un sistema completo de tracking de sesiones que te permite:

- ‚úÖ Ver qui√©n est√° conectado en tiempo real
- ‚úÖ Analizar patrones de uso
- ‚úÖ Detectar intentos de acceso no autorizados
- ‚úÖ Obtener insights sobre tu audiencia
- ‚úÖ Exportar datos para reportes

**¬øNecesitas ayuda?** Revisa la secci√≥n de [Soluci√≥n de Problemas](#soluci√≥n-de-problemas) o abre un issue en GitHub.
